<div class="cart-fixed" id="cart">
    <div class="js-close-card"></div>
    <div class="cart-fixed__wrap">
        {% if cart.item_count > 0 %}
        <p class="text-center"><strong>Total {{ cart.total_price | money }}</strong></p>
        <div class="btn-payment"><a href="/checkout"><i class="fa fa-lock"></i>Proceed to Payment</a></div>
        <p class="text-center">{{ cart.item_count }} Products in cart</p>
        {% for item in cart.items %}
        <div class="shipping__item" data-line-id="{{ item.id }}">
            <div class="row">
                <div class="col-sm-4">
                    {% if item.image != blank %}
                      <div class="cart-img">{{ item.image | image_url: width: 143, crop: 'center' | image_tag: loading: 'lazy', alt: item.title  }}</div>
                    {% else %}
                      {% render 'icon-unavailable' %}
                    {% endif %}
                </div>
                <div class="col-sm-6">
                    <a href="" class="ttl">{{ item.title }}</a>
                    <div class="btn-view">
						<a href="#">View Detail</a>
                    </div>
                    <div class="view-more">
                        <p><strong>Lenght:</strong>7mm</p>
                        <p><strong>Titanium Color:</strong>Yellow - 60-63 Volt</p>
                        <p class="qtybox"><strong>Quantity:</strong><input type="text" class="qty" value="{{ item.quantity }}"></p>
                    </div>
                </div>
                <div class="col-sm-2">
                    <p class="price">{{ item.price | money }}</p>
                    <div class="btn-link-gray">
                        <a href="javascript:void(0)" onclick="onDelete(this)" data-id="{{ item.id }}"><i class="fa fa-trash"></i></a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        {% endif %}
        <div class="btn-link-text text-center">
          {% liquid
            if cart.item_count > 0
              echo 'View and Edit Cart' | link_to: '/cart'
            else
              render 'icon-cart-empty'
              echo 'Continuing shopping' | link_to: '/collections'
            endif
          %}
        </div>
    </div>
</div>
<div class="cart-bg"></div>
<script type="text/javascript">
async function removeItem(data) {
    return await fetch("/cart/change.json", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Accept": "application/json"
        },
        body: JSON.stringify({
            ...data,
            quantity: 0
        })
    });
}
function onDelete(){
    var id = e.dataset.id;
    e.parentElement.innerHTML = `{% render 'icon-loading' %}`;
    removeItem({id: id}).then(res => {
        if (res.status == 200) {
            document.querySelector(`div[data-line-id="${id}"]`).remove();
        }    
    });
}
function openCart() {
    cart.target.classList.add('is-show');
    cart.screen.classList.add('is-show');
}
function closeCart() {
    cart.target.classList.remove('is-show');
    cart.screen.classList.remove('is-show');
}
var cart = {
    target: document.querySelector('#cart')
};
cart.list = document.querySelector('.js-cart');
cart.screen = document.querySelector('.cart-bg');
cart.closes = document.querySelector('.js-close-card');
cart.viewmore = document.querySelectorAll('.btn-view a');
cart.list.addEventListener('click', e => {
    e.preventDefault();
    openCart();
});
cart.closes.addEventListener('click', () => {
    closeCart();
});
cart.viewmore.forEach(e => {
    e.addEventListener('click', e => {
        e.target.classList.toggle('is-active');
        var next = e.target.parentElement.nextElementSibling;
        if (next.style.display === '' || next.style.display === 'none') {
            next.style.display = "block";
        } else {
            next.style.display = 'none';
        }
    });
});
</script>