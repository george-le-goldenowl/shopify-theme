<section class="section-content-first">
    <div class="container">
        <div class="row">
            <div class="col-lg-4">
                <div class="menu-profile-wrap">
                    <ul class="menu-profile">
                        <li><a href=""><span class="icon"><i class="fa fa-user" aria-hidden="true"></i></span>Account Dashboard</a></li>
                        <!-- TODO -->
                        <li><a href=""><span class="icon"><i class="fa fa-shopping-cart" aria-hidden="true"></i></span>My orders</a></li> 
                        <li><a href=""><span class="icon"><i class="fa fa-credit-card-alt" aria-hidden="true"></i></span>Payment Data</a></li>
                        <!-- TODO: remove localstorage Customer_Mode -->
                        <li><a href="javascript: ((localStorage.removeItem('Customer_Mode')), (window.location.href = '{{ routes.account_logout_url }}'));"><span class="icon"><i class="fa fa-sign-out" aria-hidden="true"></i></span>Log Out</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-8">
                <div class="profile-content">
                    <h3 class="ttl-4">Account Dashboard</h3>
                    <div class="profile-content-item">
                        <h3 class="ttl-5">Account Infomation</h3>   
                        <div class="row">
                            <div class="col-sm-6">
                                <p><strong>Contact Infomation</strong></p>
                                <p class="customer-name">{{ customer.name }}</p>
                                <p class="customer-email">{{ customer.email }}</p>
                                <!-- TODO -->
                                <div class="btn-text d-flex">
                                    <a href="">Edit</a>
                                    <a href="">Change Password</a>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <!-- TODO -->
                                <p><strong>Newsletters</strong></p>
                                <p>You are subscribed to "General Subscription".</p>
                                <div class="btn-text d-flex">
                                    <a href="">Edit</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="profile-content-item">
                        <h3 class="ttl-5">Address book</h3>
                        <div class="wrap-list-address">
                            <div class="row">
                                <div class="col-sm-6" id="default-address">
                                    <p><strong>Default Address</strong></p>
                                    {%- if customer.default_address != blank -%}
                                        {{ customer.default_address | format_address }}
                                        <div class="btn-text d-flex" data-address-id="{{ customer.default_address.id }}" data-address='{{ customer.default_address | json }}'>
                                            <a href="javascript:void(0)" onclick="ShowEditForm(this)">Edit</a>
                                        </div>
                                    {%- else -%}
                                        <p>You have not set a default billing address.</p>
                                    {%- endif -%}
                                </div>
                                <div class="col-sm-6 list-address"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script type="text/javascript">
'use strict';
var Account = {};

window.addEventListener("load", async (b) => {
    if (
        ((Account.Content = document.querySelector(".profile-content")),
        (Account.Address = "{{ customer.addresses | json }}"),
        (Account.ListAddress = Account.Content.querySelector(".list-address")),
        (Account.WrapListAddress = Account.Content.querySelector(".wrap-list-address")),
        Account.Address)
    ) {
        var a = "<p><strong>List Address</strong></p>";
        JSON.parse(Account.Address).forEach((b) => {
            let d = JSON.stringify(b);
            if (!b.default) {
                var c = [];
                c.push(b.name),
                    c.push(b.company),
                    c.push(b.address1),
                    c.push(b.address2),
                    c.push(`${b.city} ${b.province_code} ${b.zip}`),
                    c.push(b.country),
                    (a += c.join("<br/>")),
                    (a += `
                    <div class="btn-text d-flex" data-address-id="${b.id}" data-address='${d}'>
                        <a href="javascript:void(0)" onclick="ShowEditForm(this)">Edit</a>
                    </div>
                    <hr/>
                `);
            }
        }),
            (Account.ListAddress.innerHTML = a);
    } else
        Account.ListAddress.innerHTML = `
            <p>You have not set a default shipping address.</p>
            <div class="btn-text d-flex">
                <a href="javascript:void(0)">Add new</a>
            </div>
        `;
});
const ShowEditForm = async (a) => {
    var d,
        e,
        b = a.parentElement.dataset.addressId;
    await Account.WrapListAddress.insertAdjacentHTML("beforeend", GenerateEditForm(JSON.parse(a.parentElement.dataset.address))), (Account.WrapListAddress.firstElementChild.style.display = "none");
    var c = Account.Content.querySelector(`#AddressCountry_${b}`);
    c && (await SelectedCountry(c, b));
},
onCancelEditForm = (a) => {
    document.querySelector(`form#address_form_${a}`) && document.querySelector(`form#address_form_${a}`).remove(), (Account.WrapListAddress.firstElementChild.style.display = "flex");
},
GenerateProvices = (a, e) => {
    var b = a.options[a.selectedIndex].getAttribute("data-provinces"),
        c = Account.Content.querySelector(`#AddressProvinceContainer_${e}`),
        d = c.closest(".address-province");
    (c.innerHTML = ""),
        JSON.parse(b).length
            ? (JSON.parse(b).forEach((b) => {
                  var a = document.createElement("option");
                  (a.value = b[0]), (a.selected = c.dataset.default == b[0]), (a.innerHTML = b[1]), c.appendChild(a);
              }),
              d.classList.remove("d-none"))
            : d.classList.add("d-none");
},
SelectedCountry = (a, e) => {
    for (var c = a.dataset.default, b = 0; b <= a.options.length; b++) {
        var d = a.options[b];
        if (c == d.value || c == d.innerHTML) {
            a.selectedIndex = b;
            break;
        }
    }
    GenerateProvices(a, e);
},
GenerateEditForm = (b) => {
    var c,
        a = b.id;
    return `
    <form method="post" action="/account/addresses/${a}" id="address_form_${a}" accept-charset="UTF-8">
        <input type="hidden" name="form_type" value="customer_address">
        <input type="hidden" name="utf8" value="âœ“">

        <div class="shipping__form">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="AddressFirstName_${a}">First name</label>
                        <input 
                            id="AddressFirstName_${a}"
                            type="text"
                            name="address[first_name]" 
                            value="${b.first_name}" 
                            class="form-control form-control-line address_form" 
                        />
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="AddressLastName_${a}">Last Name</label>
                        <input 
                            id="AddressLastName_${a}"
                            type="text"  
                            name="address[last_name]" 
                            value="${b.last_name}" 
                            class="form-control form-control-line address_form"
                        />
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="AddressCompany_${a}">Company</label>
                        <input 
                            id="AddressCompany_${a}"
                            type="text"  
                            name="address[company]" 
                            value="${b.company}"
                            class="form-control form-control-line address_form"
                        />
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="AddressAddress1_${a}">Address</label>
                        <input 
                            id="AddressAddress1_${a}"
                            type="text"  
                            name="address[address1]" 
                            value="${b.address1}"
                            class="form-control form-control-line address_form"
                        />
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="AddressAddress2_${a}">Apartment</label>
                        <input 
                            id="AddressAddress2_${a}"
                            type="text"  
                            name="address[address2]" 
                            value="${b.address2}"
                            class="form-control form-control-line address_form"
                        />
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="AddressCity_${a}">City</label>
                        <input 
                            id="AddressCity_${a}"
                            type="text"  
                            name="address[city]" 
                            value="${b.address2}"
                            class="form-control form-control-line address_form"
                        />
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="AddressCountry_${a}">Country<span class="txt-error">*</span></label>
                        <select 
                            onchange="GenerateProvices(this, ${a})"
                            id="AddressCountry_${a}" 
                            name="address[country]" 
                            class="form-control form-control-line address_form" 
                            data-default="${b.country}" 
                            data-address-id="${a}" 
                            autocomplete="country">
                            {{ all_country_option_tags }}
                        </select>
                    </div>
                </div>
                <div class="col-md-6 address-province d-none">
                    <div class="form-group">
                        <label for="AddressProvinceContainer_${a}">Province<span class="txt-error">*</span></label>
                        <select 
                            id="AddressProvinceContainer_${a}" 
                            name="address[province]" 
                            class="form-control form-control-line" 
                            data-default="${b.province}">
                        </select>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="AddressZip_${a}">Postal Code/Zip</label>
                        <input 
                            id="AddressZip_${a}"
                            type="text"  
                            name="address[zip]" 
                            value="${b.zip}"
                            class="form-control form-control-line"
                            autocomplete="postal-code" 
                            data-required="true" 
                        />
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="AddressPhone_${a}">Phone</label>
                        <input 
                            id="AddressPhone_${a}"
                            type="text"  
                            name="address[phone]" 
                            value="${b.phone}"
                            class="form-control form-control-line"
                            autocomplete="tel" 
                            data-required="true" 
                        />
                    </div>
                </div>
            </div>
        </div>
        <div class="shipping__btn row">
            <div class="col-sm-6">
                <div class="shipping__btn btn-submit">
                    <div class="btn-payment"><a href="javascript: document.querySelector('form#address_form_${b.id}').submit()">Edit</a></div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="shipping__btn">
                    <div class="btn-back"><a href="javascript:void(0)" onclick="onCancelEditForm(${a})">Back</a</div>
                </div>
            </div>
        </div>
        <input type="hidden" name="_method" value="put"></form>
    </form>
`;
};

</script>